<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Orienteering</title>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jspsych.js"></script>
    <script src="./js/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="./js/plugins/jspsych-external-html.js"></script>
    <script src="./js/plugins/jspsych-instructions.js"></script>
    <link href="./js/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>
  <script>
    
// #################  create timeline  #################
var timeline = [];  // The last thing we do is to run it!


// #################  The demographics screen  #################
var check_consent = function(elem) {
      // get the values of radio buttons on the external form
        function getRadioButton(name) {
            var i, radios = document.getElementsByName(name);
            for (i = 0; i < radios.length; i = i + 1) {
                if (radios[i].checked) {
                    return (radios[i].value);
                }
            }
        }
        
        jsPsych.data.addProperties({
            age: document.getElementById("age").value,
            experience: getRadioButton("experience"),
            handedness: getRadioButton("handedness"),
            language: document.getElementById("language").value,
	        gender: getRadioButton("gender"),
            country: document.getElementById("country").value
            mapholding: getRadioButton("mapholding").value,
            })

        
        // Effectively checks to ensure that we have valid inforamtion in all fields
        // won't let you move forward unless all boxes have an answer

    return true // Returning true moves us on the the next item in the timeline
                // returning false would prevent progress
};

        
// generate a random subject ID with 15 characters
var subject_id = jsPsych.randomization.randomID(15);

// pick a random condition for the subject at the start of the experiment
var condition_assignment = jsPsych.randomization.sampleWithoutReplacement(['conditionA', 'conditionB', 'conditionC'], 1)[0];

// record the condition assignment in the jsPsych data
// this adds a property called 'subject' and a property called 'condition' to every trial
jsPsych.data.addProperties({
  subject: subject_id,
  condition: condition_assignment


    });

    var introduction = {
      type:'external-html',
      url: "./doc/demographics_page.html", // Declare path in app.yaml !
      cont_btn: "demographics_done", // Name of button on called form
      check_fn: check_consent
      };



 // #################  run the timeline  #################

    jsPsych.init ({
        timeline: [introduction],  // Oooh yes, now we execute the time line for the experiment
        on_finish: function() { endExperiment( 
            jsPsych.data.get().csv(), 
            function() {document.write('All done!<br>its possible.</br>')}
                )
            }
        });

    // The endExperiment function called on completion of the timeline

    function endExperiment(dataset,callback) {
        $.post('submit',{"content": dataset});
        setTimeout(callback,1000)
    }  
    // Posts the dataset into a location where it can be found by the app engine

   </script>
</html>
