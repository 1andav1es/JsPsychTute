<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Orienteering</title>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jspsych.js"></script>
    <script src="./js/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="./js/plugins/jspsych-html-button-response.js"></script>
    <script src="./js/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="./js/plugins/jspsych-external-html.js"></script>
    <script src="./js/plugins/jspsych-instructions.js"></script>
    <script src="./js/plugins/jspsych-image-keyboard-response.js"></script>
    <link href="./js/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>
    
    
// #################  create timelines & other variables  #################

var timeline = [];  // Create the variable but not run it!
var is_beginner;
var demographic_information;

// #################  create introduction screen  #################

    var introduction = {
      type:'external-html',
      url: "./doc/introduction_page.html",  // relative path (add to app.yaml!)
      cont_btn: "next_b",
      };
    timeline.push(introduction);  // Into the timeline

// #################  create consent screen  #################

    // Function that checks if a subject has given consent to participate.
    // This stops execution of the rest of the timeline until the agreement checkbox is checked
    var check_consent = function(elem) {
        if ($('#consent_checkbox').is(':checked')) {
            return true;  // Returning true lets us keep going
        }
        else {
            alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
            return false;  // False keeps us on the form
        }
        return false;
    };
 
    // declare the block.
    var consent = {
        type:'external-html',
        url: "./doc/consent_page.html",  // relative path (add to app.yaml!)
        cont_btn: "start",
        check_fn: check_consent  // Run the check_consent function
    };
    timeline.push(consent);  // Into the timeline

// #################  create demographics screen  #################

    var check_consent = function(elem) {
        // get the value of a radio button
        function getRadioButton(name) {
            var i, radios = document.getElementsByName(name);
            for (i = 0; i < radios.length; i = i + 1) {
                if (radios[i].checked) {
                    return (radios[i].value);
                }
            }
        }
	    demographic_information = [
        ("gender:" + getRadioButton("gender")),
        ("age:" + document.getElementById("age").value),
        ("language:" + document.getElementById("language").value),
        ("country:" + document.getElementById("country").value),
        ("experience:" + getRadioButton("experience")),
        ("handedness:" + getRadioButton("handedness")),
        ("handedness:" + getRadioButton("colourblind")),
        ("mapholding:" + getRadioButton("mapholding"))]
        is_beginner = getRadioButton("experience")  // for later!
        // Effectively checks to ensure that we have valid inforamtion in all radio buttons
        // won't let you move forward unless all radio's have been answered
    
        return true // Returning true moves us on the the next item in the timeline
                    // returning false would prevent progress
    };

    var demographics = {
        type:'external-html',
        url: "./doc/demographics_page.html",
        cont_btn: "demographics_done",
        check_fn: check_consent
        };
    timeline.push(demographics);
    jsPsych.data.addProperties({demographic_information});

// #################  a banner screen that shows briefly  #################

    introduction = {
        type: 'image-keyboard-response',
        stimulus: 'img/intro1.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(introduction);

// #################  create training screens  #################

    var map_reading = {  // The user can scroll back and forwards in this list
        type: 'instructions',
        pages: [
            '<img src="img/intro2.jpg"></img>',
            '<img src="img/intro3.jpg"></img>',
            '<img src="img/intro4.jpg"></img>',
            '<img src="img/intro5.jpg"></img>',
            '<img src="img/intro6.jpg"></img>',
            '<img src="img/intro7.jpg"></img>',
            '<img src="img/intro8.jpg"></img>'],
        show_clickable_nav: true
    }
    // Here we only show the introduction stuff if they are a beginner or have 'some experience'
    var if_node = {
        timeline: [map_reading],
        conditional_function: function(){  // Conditional function prevents page displaying if false
            // get the data from the previous trial, and decide if we will see it
            if((is_beginner == "never")|(is_beginner == "some")){
                return true;
            } else {
                return false;
            }
        }
    }

// #################  The test questions  #################

var options_area = ["I can run / walk on this", "Its uncrossable"];
var options_object = ["I can cross this", "I have to go around"];
var instructioncorrect = false;

var instruction_check = {
        type: "survey-multi-choice",
        preamble: ["<p align='center'><b>Check your knowledge before you begin the experiment!</b></p><p>Take care answering, you need to get these questions correct before you can proceed to the experiment</p>"],
        questions: [{prompt: "<b>Q1</b>: Can you cross an area marked like this?    <img src=./img/symBLD.jpg>", options: options_area},
                    {prompt: "<b>Q2</b>: Can you cross over one of these?    <img src=./img/symWAP.jpg>", options: options_object},
                    {prompt: "<b>Q3</b>: Is an area marked like this crossable?    <img src=./img/symGRS.jpg>", options: options_area},
                    {prompt: "<b>Q4</b>: Is an area marked like this crossable?    <img src=./img/symOOB.jpg>", options: options_area},
                    {prompt: "<b>Q5</b>: Can you cross over one of these?    <img src=./img/symFEP.jpg>", options: options_object},
                    {prompt: "<b>Q6</b>: Is an area marked like this crossable?    <img src=./img/symCAN.jpg>", options: options_area},
                    {prompt: "<b>Q7</b>: Can you cross over one of these?    <img src=./img/symWAI.jpg>", options: options_object},
                    {prompt: "<b>Q8</b>: Is an area marked like this crossable?    <img src=./img/symTRE.jpg>", options: options_area},
                    {prompt: "<b>Q9</b>: Can you go along one of these?    <img src=./img/symSTA.jpg>", options: options_area},
                    {prompt: "<b>Q10</b>: Is an area marked like this crossable?    <img src=./img/symCON.jpg>", options: options_area},
                    {prompt: "<b>Q11</b>: Can you cross over one of these?    <img src=./img/symFEI.jpg>", options: options_object},
                    {prompt: "<b>Q12</b>: Is an area marked like this crossable?    <img src=./img/symPVE.jpg>", options: options_area},
                    {prompt: "<b>Q13</b>: Is an area marked like this crossable?    <img src=./img/symGDN.jpg>", options: options_area}],
        on_finish: function(data) {
            console.log(data.responses);  // comment out after debugging (use to copy correct response string into line below)
            if( data.responses == '{"Q0":"Its uncrossable","Q1":"I can cross this","Q2":"I can run / walk on this","Q3":"Its uncrossable","Q4":"I can cross this","Q5":"I can run / walk on this","Q6":"I have to go around","Q7":"I can run / walk on this","Q8":"I can run / walk on this","Q9":"Its uncrossable","Q10":"I have to go around","Q11":"I can run / walk on this","Q12":"Its uncrossable"}') {
                instructioncorrect = true;  // questions answered correctly
            }else{
              instructioncorrect = false;  // some were wrong
              is_beginner = "some"  // Here we flip the visibility of the map reading instuction section, so an elete who makes a mistake has to read everything and do the questions again!
            };   
        }
    };          

      var splash_screen = {
          type: 'html-button-response',
        stimulus: '<p>Some of your answers were incorrect</p>',
        choices: ['Click here to review the introduction']
      };
      var conditional_instruction = {
          timeline: [splash_screen],
          conditional_function: function(data) {
              return !instructioncorrect // skip if correct
          }
      };
      var conditional_splash = {  // This command adds the training, questionare, and splash screen into a timeline loop
          timeline: [if_node, instruction_check, conditional_instruction],
          loop_function: function(data) {
             return !instructioncorrect // Keep looping until correct
            }
      };
    timeline.push(conditional_splash);   
 
// #################  create Briefing screens  #################

    var instructions = {
        type: 'instructions',
        pages: [
            '<img src="img/briefing1.jpg"></img>',
            '<img src="img/briefing2.jpg"></img>',
            '<img src="img/briefing3.jpg"></img>'],
        show_clickable_nav: true
    };
    timeline.push(instructions);

// #################  create 'Can We?' demo screens  #################

// Fixation
    var CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-01-y-start.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Map
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-01-y-map.jpg',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Picture
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-01-y-pic.jpg',
        choices: ['Y', 'N'],
        prompt: "<p>If you can get to the control, press 'Y'. If you can't, press 'N'",
        response_ends_trial: true
    };
    timeline.push(CWdemo);
// Notice that the 'real' block is about to start
    CWdemo = {
        type: 'instructions',
        pages: [
            '<img src="img/briefing4.jpg"></img>'],
        show_clickable_nav: true
    };
    timeline.push(CWdemo);

// @@@@@@@@@@@@@@@@ boilerplate Can We? test @@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@                          @@@@@@@@@@@@@@@@


// Fixation
    var CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-02-y-start.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Map
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-02-y-map.jpg',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Picture
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-02-y-pic.jpg',
        choices: ['Y', 'N'],
        prompt: "<p>If you can get to the control, press 'Y'. If you can't, press 'N'",
        response_ends_trial: true
    };
    timeline.push(CWdemo);


// Fixation
    var CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-09-y-start.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Map
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-09-y-map.jpg',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Picture
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-09-y-pic.jpg',
        choices: ['Y', 'N'],
        prompt: "<p>If you can get to the control, press 'Y'. If you can't, press 'N'",
        response_ends_trial: true
    };
    timeline.push(CWdemo);


// Fixation
    var CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-11-n-start.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Map
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-11-n-map.jpg',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Picture
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-11-n-pic.jpg',
        choices: ['Y', 'N'],
        prompt: "<p>If you can get to the control, press 'Y'. If you can't, press 'N'",
        response_ends_trial: true
    };
    timeline.push(CWdemo);
    introduction = {
        type: 'image-keyboard-response',
        stimulus: 'img/intro1.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);


// Fixation
    var CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-12-n-start.jpg',
        trial_duration: 1000,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Map
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-12-n-map.jpg',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
    };
    timeline.push(CWdemo);
// Picture
    CWdemo = {
        type: 'image-keyboard-response',
        stimulus: './img/CW-12-n-pic.jpg',
        choices: ['Y', 'N'],
        prompt: "<p>If you can get to the control, press 'Y'. If you can't, press 'N'",
        response_ends_trial: true
    };
    timeline.push(CWdemo);


// @@@@@@@@@@@@@@@@                          @@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@     end boilerplate      @@@@@@@@@@@@@@@@


// #################  create debrief screen  #################
    var debrief = 
    {
        type: 'html-keyboard-response',
        stimulus: 'All done.  Thank you for your participation.',
        choices: [' '],
        prompt: "<p>Pressing the space bar will save the data.</p>"
    };
    timeline.push(debrief);

 // #################  run the timeline  #################

    jsPsych.init ({
        timeline: timeline,  // Oooh yes, now we execute the time line for the experiment
        preload_images: images,
        on_finish: function() { 
            endExperiment( jsPsych.data.get().csv(), function() {document.write(
                '<div id="endscreen" class="endscreen" style="width:1000px"><div class="endscreen" style="text-align:center; border:0px solid; padding:10px; font-size:120%; width:800px; float:right"><p><br><br><br>All done!<br><br>The data has been saved - you may close this window. Please contact me if something goes wrong and I\'ll fix it as quickly as possible.</p></div></div>'
                        )
                    }
                )
            }
        });
// The endExperiment function is called on completion of the timeline

    function endExperiment(dataset,callback) {
        $.post('submit',{"content": dataset});
        setTimeout(callback,1000)
    }  
// Posts the dataset into a location where it can be found by the app engine

	  /* image list */
	  var images = [
		  './img/intro1.jpg',
		  './img/intro2.jpg',
		  './img/intro3.jpg',
		  './img/intro4.jpg',
		  './img/intro5.jpg',
		  './img/intro6.jpg',
		  './img/intro7.jpg',
		  './img/intro8.jpg',
		  './img/briefing1.jpg',
		  './img/briefing2.jpg',
		  './img/briefing3.jpg',
		  './img/briefing4.jpg',
		  './img/CW-01-y-start.jpg',
		  './img/CW-01-y-map.jpg',
		  './img/CW-01-y-pic.jpg',
		  './img/CW-02-y-start.jpg',
		  './img/CW-02-y-map.jpg',
		  './img/CW-02-y-pic.jpg',
		  './img/CW-09-y-start.jpg',
		  './img/CW-09-y-map.jpg',
		  './img/CW-09-y-pic.jpg',
		  './img/CW-11-n-start.jpg',
		  './img/CW-11-n-map.jpg',
		  './img/CW-11-n-pic.jpg',
		  './img/CW-12-n-start.jpg',
		  './img/CW-12-n-map.jpg',
		  './img/CW-12-n-pic.jpg'
        ];

        
//// generate a random subject ID with 15 characters
//var subject_id = jsPsych.randomization.randomID(15);

//// pick a random condition for the subject at the start of the experiment
//var condition_assignment = jsPsych.randomization.sampleWithoutReplacement(['conditionA', 'conditionB', 'conditionC'], 1)[0];
//// record the condition assignment in the jsPsych data
//// this adds a property called 'subject' and a property called 'condition' to every trial
//    jsPsych.data.addProperties({
//    subject: subject_id,
//    condition: condition_assignment
//    });







   </script>
</html>
